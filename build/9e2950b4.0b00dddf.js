(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{120:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return i})),a.d(t,"default",(function(){return p}));var n=a(1),r=a(6),s=(a(0),a(135)),o={id:"framework-rest-manager",title:"Rest Routes",sidebar_label:"Rest Routes"},c={id:"framework-rest-manager",title:"Rest Routes",description:"With SCIWP you can define REST API routes in the same way you would define standard routes. REST routes usually match a file, a function or a controller's class method, which is in charge of parsing the incoming data and provide a response.\r",source:"@site/docs\\rest-manager.md",permalink:"/docs/framework-rest-manager",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/rest-manager.md",sidebar_label:"Rest Routes",sidebar:"someSidebar",previous:{title:"Routes",permalink:"/docs/framework-route-manager"},next:{title:"Providers",permalink:"/docs/framework-provider-manager"}},i=[{value:"Creating Routes",id:"creating-routes",children:[{value:"Request method",id:"request-method",children:[]},{value:"Route expression",id:"route-expression",children:[]},{value:"Route Actions",id:"route-actions",children:[]}]},{value:"Request Methods",id:"request-methods",children:[{value:"Get Method",id:"get-method",children:[]},{value:"Post Method",id:"post-method",children:[]},{value:"Put Method",id:"put-method",children:[]},{value:"Patch Method",id:"patch-method",children:[]},{value:"Delete Method",id:"delete-method",children:[]},{value:"Options Method",id:"options-method",children:[]}]},{value:"Where Restrictions",id:"where-restrictions",children:[{value:"Single Clause",id:"single-clause",children:[]},{value:"Multiple Clauses",id:"multiple-clauses",children:[]}]},{value:"Registering Routes",id:"registering-routes",children:[]},{value:"Rest Request Object",id:"rest-request-object",children:[]},{value:"Rest Manager",id:"rest-manager",children:[]}],l={rightToc:i};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(s.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(s.b)("p",null,"With SCIWP you can define REST API routes in the same way you would define standard routes. REST routes usually match a file, a function or a controller's class method, which is in charge of parsing the incoming data and provide a response."),Object(s.b)("p",null,"Although they are defined in similar way, standard routes using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Route"))," class and REST routes using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest")),"  class are managed in a different way, and that's way we need a ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Route Manager"))," and a ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Rest Manager")),". The reason for this is that, on one hand, WordPress manages standard routes with permalinks and on the other hand, WordPress manages REST routes with a system wich is similar to the way we usually define routes with most PHP frameworks."),Object(s.b)("p",null,"REST routes can answer to one or many REST methods, returning a JSON object."),Object(s.b)("p",null,"The ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class stores all data needed for a route definition, including the route expression, the parameters and matching action that will be executed with the defined parameters when the requested route matches the specified route."),Object(s.b)("h2",{id:"creating-routes"},"Creating Routes"),Object(s.b)("p",null,"To create a new route you can just use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"create"))," static method  of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class. The create method accepts the following parameters:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"namespace (string)"),": The namespace is prepended to the route parameter (the third parameter of this method). The namespace allows to create different versions of the same endpoints.")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"method (string|array)"),": This is the request method for this route. You can specify ",Object(s.b)("inlineCode",{parentName:"p"},"'get'"),", ",Object(s.b)("inlineCode",{parentName:"p"},"'post'"),", ",Object(s.b)("inlineCode",{parentName:"p"},"'put'"),", ",Object(s.b)("inlineCode",{parentName:"p"},"'patch'"),", ",Object(s.b)("inlineCode",{parentName:"p"},"'delete'")," and ",Object(s.b)("inlineCode",{parentName:"p"},"'options'")," as values for this parameter. You can also specify an array of values in case you want the route to answer more than one method. If you want the route to answer all HTTP methods, just use ",Object(s.b)("inlineCode",{parentName:"p"},"'any'")," as the value.")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"route (string)"),": This is the route definition, which is relative to the web domain and goes just after the namespace. You can specify parameters between braces. You will then be able to use these parameters in the function or controller method defined as the action. It's possible to specify restrinctions for these parameters if you write a vertical bar just after the last character of the parameter name, followed by a regular expression.")),Object(s.b)("li",{parentName:"ul"},Object(s.b)("p",{parentName:"li"},Object(s.b)("strong",{parentName:"p"},"action (mixed)"),": This is the function, class method or file which will be called when the request matches the route expression. You can specify files, callback functions and class methods."))),Object(s.b)("p",null,"Here is an example of how to create a route using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"create"))," static method:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/route/{parameter}', function($parameter) { /* ... */ });\n")),Object(s.b)("p",null,"You can then access the previous API route at, for example: ",Object(s.b)("inlineCode",{parentName:"p"},"mydomain.tld/wp-json/myplugin/v2/route/whatever"),"."),Object(s.b)("h3",{id:"request-method"},"Request method"),Object(s.b)("p",null,"When creating a REST route, the first parameter indicates the request method, which can be ",Object(s.b)("strong",{parentName:"p"},"get"),", ",Object(s.b)("strong",{parentName:"p"},"post"),", ",Object(s.b)("strong",{parentName:"p"},"put"),", ",Object(s.b)("strong",{parentName:"p"},"patch"),", ",Object(s.b)("strong",{parentName:"p"},"delete")," or ",Object(s.b)("strong",{parentName:"p"},"options"),". You can also specify an ",Object(s.b)("strong",{parentName:"p"},"array of request methods")," so the endpoint answers to more than one methods, or use ",Object(s.b)("strong",{parentName:"p"},"any")," for the endpoint to answer all request methods."),Object(s.b)("p",null,"For example, if you want to specify a route which will call a function in charge of deleting a news article, the route might be the next one:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\nuse MyPlugin\\App\\Controllers\\Article;\n\nRest::create('myplugin/v1', 'delete', '/news/{permalink}', function($permalink) {\n\n  # Getting an article from the database\n  $article = Article::findOne('permalink', $permalink);\n\n  if ($article) {\n    # Delete the article\n    $article->remove();\n\n    # Article deleted: Return 204 status\n     wp_send_json([ 'message' => 'Article deleted' ], 204);\n  }\n\n  # Return an error\n  wp_send_json([ 'message' => 'Article not found' ], 404);\n});\n")),Object(s.b)("h3",{id:"route-expression"},"Route expression"),Object(s.b)("p",null,"When creating a route using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"create"))," static method of the Rest class, you must specify the matching route using the second parameter. You can specify static routes or add different parameters. "),Object(s.b)("h4",{id:"creating-a-static-route"},"Creating a Static Route"),Object(s.b)("p",null,"Static routes have no parameters. Here is an example of a static route which will answer to the request ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"/news")),":"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/news', function() { /*... */ });\n")),Object(s.b)("h4",{id:"creating-a-dynamic-route"},"Creating a Dynamic Route"),Object(s.b)("p",null,"You can specify dynamic parameters or variables between braces. The next example will answer to the get requests ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"/cars/seat")),", ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"/cars/ford"))," and ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"/cars/any-model")),"."),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{model}', function($model) { /*... */ });\n")),Object(s.b)("p",null,"You can add all parameters you want:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', function($make, $model) { /*... */ });\n")),Object(s.b)("h4",{id:"creating-a-route-with-optional-parameters"},"Creating a Route With Optional Parameters"),Object(s.b)("p",null,"To make a parameter optional, just append a question mark after it. In the next example, the route will answer to both the requests ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"/cars"))," and ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"/cars/any-car")),"."),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\n# If the model is not set, it will default to false\nRest::create('myplugin/v1', 'get', '/cars/{model?}', function($model = false) { /*... */ });\n")),Object(s.b)("h4",{id:"parameter-restrictions"},"Parameter Restrictions"),Object(s.b)("p",null,"It's also possible to set some conditions for the specified parameters in the route definitions using a regular expression. For example, you might want to limit the format of the parameter to the letters which go from ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"a"))," to ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"z"))," and also limit the parameter to 10 characters length. To do so, you would write the regular expression after the parameter name, separated with a vertical bar:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{model|[a-z]{10}}', function($model) { /*... */ });\n")),Object(s.b)("h4",{id:"parameter-restrictions-with-a-where-clause"},"Parameter Restrictions with a Where Clause"),Object(s.b)("p",null,"Another way to define parameter requirements is to use a where clause after the route definition, so the previous example is equivalent to this one:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\n$routeManager->route('myplugin/v1', 'get', '/cars/{make}',  function($model) { /*... */ })->where('make', '[a-z]{10}');\n")),Object(s.b)("p",null,"You also specify additional where clauses:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', function($model, $model) { /*... */ })->where('make', '[a-z]{10}')->where('model', '[a-z0-9]{10}');\n")),Object(s.b)("h3",{id:"route-actions"},"Route Actions"),Object(s.b)("p",null,"The action is the third parameter you need to create a route, and is the function or method which will be executed. You can specify a function, a method or a file to include."),Object(s.b)("h4",{id:"using-a-function-as-an-action"},"Using a Function as an Action"),Object(s.b)("p",null,"This is the action type of the previous examples. If you want the route to use a function, you can add in in this way:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', function($make, $model) {\n    wp_send_json([\n      'make' => $make,\n      'model' => $model\n    ], 200);\n});\n")),Object(s.b)("p",null,"You can also define ",Object(s.b)("strong",{parentName:"p"},"default values")," for the parameters. If a parameter is optional, don't forget to specify a default value for it in the function definition:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model?}', function($make, $model = 'general') {\n\n    wp_send_json([\n      'make' => $make,\n      'model' => $model\n    ], 200);\n});\n")),Object(s.b)("p",null,"Although is not common when using spare functions, it's also possible to ",Object(s.b)("strong",{parentName:"p"},"inject dependencies"),". An instance of the dependency will be created and sent to the defined function as an argument:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\nuse MyPlugin\\App\\Services\\Link;\n\nRest::create('myplugin/v1', 'get', '/news/{permalink}', function($permalink, Link $link) {\n  wp_send_json([ 'permalink' => $permalink ], 200);\n});\n")),Object(s.b)("h4",{id:"using-a-method-as-an-action"},"Using a Method as an Action"),Object(s.b)("p",null,"You can specify a class method formatted as ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"class@method")),". You can use the request object to get the parameters or specify them in the definition of the class method."),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', 'MyPlugin\\App\\Controller\\Cars@showCar');\n")),Object(s.b)("p",null,"In the previous example, a new instance of the class ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Cars"))," will be created when a user access the matching route, and the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"showCar"))," method will be called on that instance. A new instance of the specified class will always be created unless the singleton pattern is used. As in the case of functions, you need to define the matching route parameters you want get get into the controller method definition."),Object(s.b)("p",null,"You can inject dependencies into the controller constructor. This is can example of how you can define dependencies:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace  MyPlugin\\App\\Controllers;\n\nuse MyPlugin\\App\\Services\\Cars;\n\nclass Cars\n{\n  private $carsService;\n  \n  public function __construct(Cars $carsService)\n  {\n    $this->carsService = $carsService;\n  }\n  \n  public function showCar($make, $model)\n  {\n    $car = $this->carsService->getCar($make, $model);\n\n    if ($car) wp_send_json([ 'data' => $car ], 200);\n    else wp_send_json([ 'message' => 'The requested car does not exist' ], 404);\n  }    \n}\n")),Object(s.b)("p",null,"If you call a ",Object(s.b)("strong",{parentName:"p"},"static method")," using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"class@method"))," action format, a the new instance will be created in any case."),Object(s.b)("h4",{id:"using-a-static-method-as-an-action"},"Using a Static Method as an Action"),Object(s.b)("p",null,"If you just want to execute a ",Object(s.b)("strong",{parentName:"p"},"static method")," of a class without creating a new instance, you can define the action using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"class::method"))," format. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', 'MyPlugin\\App\\Controller\\Cars::showCarStatic');\n")),Object(s.b)("p",null,"Please note that the actions defined with the form ",Object(s.b)("em",{parentName:"p"},"class::method")," just work when referencing a static method. No class instance will be created."),Object(s.b)("h4",{id:"using-a-file-as-an-action"},"Using a File as an Action"),Object(s.b)("p",null,"It's also possible to use use a file as an action. When a user access the matching route, the the specified file will be include. You must specify the full path of the file. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\nuse MyPlugin\\Sci\\Manager\\PluginManager;\n\n$myPlugin = PluginManager::instance()->get('myplugin');\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', $myPlugin->getDir() . '/app/files/actionFile.php');\n")),Object(s.b)("h2",{id:"request-methods"},"Request Methods"),Object(s.b)("p",null,"The Rest class includes short methods for the available HTTP request methods so you don't need to use this parameter, writing less code. You can match all available request methods using the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"any"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::any('myplugin/v1', '/cars', 'MyPlugin\\App\\Controllers\\Cars@getCar');\n")),Object(s.b)("p",null,"The ",Object(s.b)("em",{parentName:"p"},"getCar")," method of the ",Object(s.b)("em",{parentName:"p"},"Cars")," class will be called regardless of the request method. it's also possible to specify a specific method using one of the specific methods."),Object(s.b)("h3",{id:"get-method"},"Get Method"),Object(s.b)("p",null,"You can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"get"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class to create a GET endpoint. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::get('myplugin/v1', '/cars', 'MyPlugin\\App\\Controllers\\Cars@getCar');\n")),Object(s.b)("h3",{id:"post-method"},"Post Method"),Object(s.b)("p",null,"You can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"post"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class to create a POST endpoint. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::post('myplugin/v1', '/cars', 'MyPlugin\\App\\Controllers\\Cars@createCar');\n")),Object(s.b)("h3",{id:"put-method"},"Put Method"),Object(s.b)("p",null,"You can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"put"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class to create a PUT endpoint. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::get('myplugin/v1', '/cars/{carId}', 'MyPlugin\\App\\Controllers\\Cars@updateCar');\n")),Object(s.b)("h3",{id:"patch-method"},"Patch Method"),Object(s.b)("p",null,"You can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"patch"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class to create a PATCH endpoint. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::get('myplugin/v1', '/cars/{carId}', 'MyPlugin\\App\\Controllers\\Cars@patchCar');\n")),Object(s.b)("h3",{id:"delete-method"},"Delete Method"),Object(s.b)("p",null,"You can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"delete"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class to create a DELETE endpoint. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::get('myplugin/v1', '/cars/{carId}', 'MyPlugin\\App\\Controllers\\Cars@deleteCar');\n")),Object(s.b)("h3",{id:"options-method"},"Options Method"),Object(s.b)("p",null,"You can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"options"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Sci\\Rest"))," class to create a OPTIONS endpoint. Here is an example:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::get('myplugin/v1', '/cars', 'MyPlugin\\App\\Controllers\\Cars@getOptions');\n")),Object(s.b)("h2",{id:"where-restrictions"},"Where Restrictions"),Object(s.b)("p",null,"When creating a route it's possible to specify parameter restrictions usin a where clause."),Object(s.b)("h3",{id:"single-clause"},"Single Clause"),Object(s.b)("p",null,"which includes the next parameters:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"parameterName (string)"),": The parameter that you want to apply the restriction."),Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"regularExpression (mixed)"),": The regular expression.")),Object(s.b)("p",null,"In the next example we restrict the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"make"))," parameter to include just characters in the range ",Object(s.b)("em",{parentName:"p"},"a-z")," and we also limit the parameter length to have from ",Object(s.b)("em",{parentName:"p"},"1")," to ",Object(s.b)("em",{parentName:"p"},"10")," characters:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}', 'MyPlugin\\App\\Controller\\Cars@view')->where('make', '[a-z]{1,10}');\n")),Object(s.b)("h3",{id:"multiple-clauses"},"Multiple Clauses"),Object(s.b)("p",null,"It's also possible to concatenate many where clauses as long as they make reference to different parameters:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', 'MyPlugin\\App\\Controller\\Cars@view')->where('make', '[a-z]{10}')->where('model', '[a-z0-9]{1,10}');\n")),Object(s.b)("p",null,"Or you can also write it in this way to avoid long lines of code:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\n$myRoute = Rest::create('myplugin/v1', 'get', '/cars/{make}/{model}', 'MyPlugin\\App\\Controller\\Cars@view');\n$myRoute->where('make', '[a-z]{10}');\n$myRoute->where('model', '[a-z0-9]{1,10}');\n")),Object(s.b)("p",null,"The ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"where"))," method also accepts an array of where clauses formatted as ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"'parameter' => $expression")),", so the previous code could be rewritten in this way:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\n$myRoute = Rest::create('myplugin/v1', 'get', '/cars/{make}/{model}', 'MyPlugin\\App\\Controller\\Cars@view');\n$myRoute->where(['make' => '[a-z]{10}', 'model' => '[a-z0-9]{1,10}']);\n")),Object(s.b)("h2",{id:"registering-routes"},"Registering Routes"),Object(s.b)("p",null,"It's not enough to create routes. Before you are able to access them, route instances must be registered into the Rest Manager. The ",Object(s.b)("strong",{parentName:"p"},"\\Sci\\Rest")," class already includes the hability to interact with the Rest Manager, so to register a route you just need to call the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"register"))," method. The ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"register"))," method accepts the following parameters:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},Object(s.b)("strong",{parentName:"li"},"routeId (string)"),": This is an optional parameter which will allow to easily retrieve routes from the Rest Manager. It's useful when you want other plugin creators to extend your plugin.")),Object(s.b)("p",null,"Here is how you would create and register a route:"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\n\n# Create a new route and register the instance\nRest::create('myplugin/v1', 'get', '/cars/{make}/{model}', 'MyPlugin\\App\\Controllers\\Car@showCar')->register('car_model');\n")),Object(s.b)("p",null,Object(s.b)("strong",{parentName:"p"},"Explanation"),": The ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"create"))," static method returns a ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"Rest"))," route instance, so it's possible to use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"register"))," method with the output."),Object(s.b)("h2",{id:"rest-request-object"},"Rest Request Object"),Object(s.b)("p",null,"You can access the WordPress API request object via the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"request"))," attribute of the Rest class. The request object is included by defautl with WordPress and includes many useful method to sanitize and get the request paramenters."),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"namespace MyPlugin;\n\nuse MyPlugin\\Sci\\Rest;\nuse MyPlugin\\App\\Controllers\\Article;\n\nRest::create('myplugin/v1', 'delete', '/news/{permalink}', function($permalink) {\n\n  # Get the permalink parameter from the request object\n  $permalink = Rest::request()->get_param('permalink');   \n\n});\n")),Object(s.b)("p",null,"You can find  ",Object(s.b)("a",Object(n.a)({parentName:"p"},{href:"https://developer.wordpress.org/reference/classes/wp_rest_request/"}),"more information about the WP_REST_request class here"),"."),Object(s.b)("h2",{id:"rest-manager"},"Rest Manager"),Object(s.b)("p",null,"When you register a route, is registered into the Rest Manager, which is in charge of adding the new permalink structures to WordPress and clearing the permalink cache. The Rest Manager is shared among all plugins using SCIWP. To get the Rest Manager you just need to get the already created instance."),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"use MyPlugin\\Sci\\Manager\\RestManager;\n\n$restManager = RestManager::instance();\n")),Object(s.b)("p",null,"If you have already created a rest route, you can use the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"register"))," method of the  ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"MyPlugin\\Sci\\Rest"))," class or also the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"register"))," method of the ",Object(s.b)("strong",{parentName:"p"},Object(s.b)("em",{parentName:"strong"},"MyPlugin\\Sci\\Manager\\RestManager"))," class to register it into the ",Object(s.b)("strong",{parentName:"p"},"Rest Manager"),":"),Object(s.b)("pre",null,Object(s.b)("code",Object(n.a)({parentName:"pre"},{className:"language-php"}),"use MyPlugin\\Sci\\Manager\\RestManager;\nuse MyPlugin\\Sci\\Rest;\n\n$myRoute = Rest::create('myplugin/v1', 'get', '/blog/{permalink}', 'MyPlugin\\App\\Controller\\Blog@view');\n\n$restManager = RestManager::instance();\n$restManager->register($myRoute);\n")),Object(s.b)("p",null,"And this has covered all aspects related to the Rest Manager."))}p.isMDXComponent=!0},135:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return g}));var n=a(0),r=a.n(n);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):c({},t,{},e)),a},u=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=Object(n.forwardRef)((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,o=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=p(a),m=n,g=u["".concat(o,".").concat(m)]||u[m]||b[m]||s;return a?r.a.createElement(g,c({ref:t},l,{components:a})):r.a.createElement(g,c({ref:t},l))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,o=new Array(s);o[0]=m;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:n,o[1]=c;for(var l=2;l<s;l++)o[l]=a[l];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);